<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Thia & Nicole Laundry - Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="toast.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <style>
        :root {
            --bg: #f4f7fb;
            --card: #fff;
            --primary: #1766ff;
            --muted: #6b7280;
            --danger: #dc2626;
        }

        * {
            box-sizing: border-box;
          }

        body {
            margin: 0;
            font-family: Inter, system-ui, Arial;
            background: url('https://images.unsplash.com/photo-1696546761269-a8f9d2b80512?fm=jpg&ixid=M3wxMjA3fDB8MHxwaG90by1yZWxhdGVkfDE4fHx8ZW58MHx8fHx8&ixlib=rb-4.1.0&q=60&w=3000') no-repeat center center/cover fixed;
            position: relative;
            overflow-x: hidden;
        }

        /* Dark gradient overlay for readability */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(188, 200, 224, 0.4), rgba(0,0,0,0.3));
            z-index: 0;
        }

        .floating-bubble {
            position: absolute;
            border-radius: 50%;
            background: rgba(174, 200, 226, 0.416); /* soft blue */
            backdrop-filter: blur(10px);
            box-shadow: 0 0 25px rgba(31, 31, 31, 0.2);
            pointer-events: none;
            animation: floatBubble linear infinite alternate;
            z-index: 1;
        }

        /* 15 bubbles, scattered & elegant */
        .bubble1  { width:120px; height:120px; top:10%; left:8%;   animation: floatBubble 8s ease-in-out infinite; }
        .bubble2  { width:200px; height:200px; bottom:25%; left:12%; animation: floatBubble 5s ease-in-out infinite 2s;}
        .bubble3  { width:90px;  height:90px;  top:5%;  left:75%;  animation: floatBubble 6s ease-in-out infinite 2s; }
        .bubble4  { width:150px; height:150px; bottom:20%; right:20%; animation: floatBubble 10s ease-in-out infinite 4s; }
        .bubble5  { width:180px; height:180px; bottom:2%; left:8%; animation: floatBubble 7s ease-in-out infinite 4s; }
        .bubble6  { width:100px; height:100px; top:50%; right:5%;   animation: floatBubble 9s ease-in-out infinite 3s; }
        .bubble7  { width:130px; height:130px; bottom:8%; right:8%; animation: floatBubble 3s ease-in-out infinite 3s; }
        .bubble8  { width:160px; height:160px; top:38%; left:55%; animation: floatBubble 3s ease-in-out infinite 3s; }
        .bubble9  { width:110px; height:110px; top:18%; left:20%; animation: floatBubble 5s ease-in-out infinite 3s; }
        .bubble10 { width:140px; height:140px; bottom:15%; left:65%; animation: floatBubble 2s ease-in-out infinite 2s; }
        .bubble11 { width:170px; height:170px; bottom:0%; right:60%; animation: floatBubble 3s ease-in-out infinite 1s; }
        .bubble12 { width:100px; height:100px; bottom:0%; left:25%; animation: floatBubble 8s ease-in-out infinite 4s; }
        .bubble13 { width:190px; height:190px; top:4%; right:5%; animation: floatBubble 6s ease-in-out infinite 2s; }
        .bubble14 { width:80px;  height:80px;  top:60%; left:30%; animation: floatBubble 5s ease-in-out infinite 5s; }
        .bubble15 { width:150px; height:150px; bottom:90%; right:45%; animation: floatBubble 3s ease-in-out infinite 2s; }

        @keyframes floatBubble {
            0%   { transform: translateY(0) translateX(0); opacity: 0.7; }
            50%  { transform: translateY(-40px) translateX(20px); opacity: 1; }
            100% { transform: translateY(0) translateX(0); opacity: 0.7; }
        }

        .app {
            max-width: 480px;
            margin: 50px auto;
            padding: 15px;
            position: relative;
            z-index: 10;
            min-height: 550px; /* Prevent layout shift during animations */
        }

        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            padding: 40px 35px;   /* dati 30px, dagdagan para lumuwag */
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            transition: all 0.7s ease;
            opacity: 1;
            transform: translateX(0);
            filter: blur(0px);
            overflow: hidden;
        }

        #create-screen {
            opacity: 0;
            transform: translateX(120%);
            filter: blur(10px);
        }

        /* Animation styles for sign-up fields */
        #create-screen .field,
        #create-screen .button-group,
        #create-screen .terms {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        #create-screen h2 {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(23, 102, 255, 0.15) 0%, transparent 70%);
            animation: rotate 25s linear infinite;
            pointer-events: none;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        h2 {
            margin: 0 0 20px;
            color: #111;
            text-align: center;
            font-size: 26px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .field {
            margin-top: 10px;
            position: relative;
            z-index: 1;
          
        }

        .field label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        .field input {
            width: 100%;
            padding: 14px 16px; /* dagdag padding sa loob ng input */
            border-radius: 10px;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
            font-size: 16px;
            margin-bottom: 8px; /* mas maluwag na pagitan bawat field */
        }


        .field input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(23, 102, 255, 0.15);
            transform: translateY(-1px);
        }

        .field.error input { border-color: var(--danger); background: #fee2e2; }
        .error-msg { color: var(--danger); font-size: 12px; margin-top: 6px; display: none; font-weight: 500; }
        .field.error .error-msg { display: block; }

        .btn {
            display: inline-block;
            margin-top: 16px;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary), #0d5eff);
            color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 12px rgba(23, 102, 255, 0.3);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(23, 102, 255, 0.4); }

        .btn.alt {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            width: auto;
            margin-top: 10px;
        }
        .btn.alt:hover { background: var(--primary); color: #fff; }

        .hidden { display: none; }

        .password-field-wrapper { position: relative; }
        .password-field-wrapper input { padding-right: 45px; }
        .password-field-wrapper .toggle-password {
            position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
            cursor: pointer; color: var(--muted); font-size: 18px; transition: color 0.3s ease;
        }
        .password-field-wrapper .toggle-password:hover { color: var(--primary); }

        .button-group { display: flex; gap: 10px; margin-top: 20px; }
        .button-group .btn.alt { flex: 1; margin-top: 0; }

        .terms {
            margin-top: 20px;
            font-size: 12px;
            color: var(--muted);
            text-align: center;
            line-height: 1.5;
        }
        .terms a { color: var(--primary); text-decoration: none; font-weight: 500; }
        .terms a:hover { text-decoration: underline; }

        @media (max-width: 480px) {
            .app { margin: 20px auto; padding: 10px; min-height: 500px; }
            .card { padding: 20px; }
            .floating-bubble { display: none; }
        }
    </style>
</head>
<body>
    <!-- Floating Bubbles -->
    <div class="floating-bubble bubble1"></div>
    <div class="floating-bubble bubble2"></div>
    <div class="floating-bubble bubble3"></div>
    <div class="floating-bubble bubble4"></div>
    <div class="floating-bubble bubble5"></div>
    <div class="floating-bubble bubble6"></div>
    <div class="floating-bubble bubble7"></div>
    <div class="floating-bubble bubble8"></div>
    <div class="floating-bubble bubble9"></div>
    <div class="floating-bubble bubble10"></div>
    <div class="floating-bubble bubble11"></div>
    <div class="floating-bubble bubble12"></div>
    <div class="floating-bubble bubble13"></div>
    <div class="floating-bubble bubble14"></div>
    <div class="floating-bubble bubble15"></div>

    <div class="app">
        <!-- SIGN IN -->
        <div id="signin-screen" class="card" data-aos="zoom-in">
            <h2>Sign In</h2>
            <div class="field">
                <label>Email</label>
                <input id="signin-email" type="email" placeholder="email@gmail.com">
                <div class="error-msg">Enter your email</div>
            </div>
            <div class="field password-field-wrapper">
                <label>Password</label>
                <input id="signin-password" type="password" placeholder="Password">
                <i class="toggle-password fas fa-eye"></i>
                <div class="error-msg">Enter your password</div>
            </div>
            <div class="button-group">
                <button class="btn" id="signin-btn">Login</button>
                <button class="btn alt" id="show-create">Create Account</button>
            </div>
            <button class="btn alt" onclick="location.href='forgot.html'" style="width: 100%; margin-top: 10px;">Forgot Password?</button>
        </div>

        <!-- CREATE ACCOUNT -->
        <div id="create-screen" class="card">
            <h2>Create Account</h2>
            <div class="field">
                <label>First name</label>
                <input id="first-name" placeholder="Juan">
                <div class="error-msg">Required</div>
            </div>
            <div class="field">
                <label>Last name</label>
                <input id="last-name" placeholder="Dela Cruz">
                <div class="error-msg">Required</div>
            </div>
            <div class="field">
                <label>Email</label>
                <input id="create-email" type="email" placeholder="email@gmail.com">
                <div class="error-msg">Must be a valid @gmail.com</div>
            </div>
            <div class="field password-field-wrapper">
                <label>Password</label>
                <input id="create-password" type="password" placeholder="Enter Password">
                <i class="toggle-password fas fa-eye"></i>
                <div class="error-msg">8-15 chars with upper, lower & special</div>
            </div>
            <div class="field password-field-wrapper">
                <label>Re-enter Password</label>
                <input id="re-password" type="password" placeholder="Re-enter Password">
                <i class="toggle-password fas fa-eye"></i>
                <div class="error-msg">Passwords do not match</div>
            </div>
            <div class="field">
                <label>Mobile#</label>
                <input id="contact" placeholder="Enter contact number">
                <div class="error-msg">Required</div>
            </div>
            <div class="field">
                <label>Address (Optional)</label>
                <input id="address" placeholder="Enter your address">
            </div>
            <div class="button-group">
                <button class="btn" id="create-btn">Create & Login</button>
                <button class="btn alt" id="back-btn">Back</button>
            </div>
            <div class="terms">
                By creating an account, you agree to our <a href="terms.html">Terms and Conditions</a> and <a href="privacy.html">Privacy Policy</a>.
            </div>
        </div>
    </div>

    <script src="toast.js"></script>
    <script>
        /* -------- LOCAL STORAGE HELPERS -------- */
        const LS_USERS = 'tn_accounts_v2';
        const LS_CURR = 'tn_current_v1';
        const HARD_ADMIN = {
            email: 'admin@laundry.com',
            password: btoa('Admin123!'),
            name: 'Administrator',
            role: 'admin',
            contact: 'N/A',
            address: 'N/A'
        };

        function getUsers() {
            let users = JSON.parse(localStorage.getItem(LS_USERS) || '[]');
            if (!users.some(u => u.email === HARD_ADMIN.email)) {
                users.push(HARD_ADMIN);
                saveUsers(users);
            }
            return users;
        }
        function saveUsers(arr) { localStorage.setItem(LS_USERS, JSON.stringify(arr)); }
        function setCurrent(u) { localStorage.setItem(LS_CURR, JSON.stringify(u)); }

        const signin = document.getElementById('signin-screen');
        const create = document.getElementById('create-screen');
        document.getElementById('show-create').onclick = () => {
            signin.style.transform = 'translateX(-120%)';
            signin.style.opacity = '0';
            signin.style.filter = 'blur(10px)';
            setTimeout(() => {
                create.style.transform = 'translateX(0)';
                create.style.opacity = '1';
                create.style.filter = 'blur(0px)';
                
                // Animate h2 first
                const h2 = create.querySelector('h2');
                setTimeout(() => {
                    h2.style.opacity = '1';
                    h2.style.transform = 'translateY(0)';
                }, 100);
                
                // Stagger animate fields, button-group, and terms
                const animatables = [
                    ...create.querySelectorAll('.field'),
                    create.querySelector('.button-group'),
                    create.querySelector('.terms')
                ];
                animatables.forEach((el, index) => {
                    setTimeout(() => {
                        el.style.opacity = '1';
                        el.style.transform = 'translateY(0)';
                    }, 200 + index * 120); // Start after h2, 120ms stagger
                });
            }, 350); // Half of transition time for staggered effect
        };
        document.getElementById('back-btn').onclick = () => {
            // Optional: Fade out elements before transitioning back (reverse animation)
            const animatables = [
                ...create.querySelectorAll('.field'),
                create.querySelector('.button-group'),
                create.querySelector('.terms'),
                create.querySelector('h2')
            ];
            animatables.forEach((el, index) => {
                setTimeout(() => {
                    el.style.opacity = '0';
                    el.style.transform = 'translateY(30px)';
                }, index * 100); // Reverse stagger for fade out
            });
            
            // Wait for fade out to complete, then transition back
            setTimeout(() => {
                create.style.transform = 'translateX(120%)';
                create.style.opacity = '0';
                create.style.filter = 'blur(10px)';
                setTimeout(() => {
                    signin.style.transform = 'translateX(0)';
                    signin.style.opacity = '1';
                    signin.style.filter = 'blur(0px)';
                }, 350);
            }, animatables.length * 100 + 200); // Adjust timing as needed
        };

        function setError(input, condition) {
            const field = input.parentElement;
            if (condition) field.classList.add('error'); else field.classList.remove('error');
        }

        document.querySelectorAll('.toggle-password').forEach(icon => {
            icon.addEventListener('click', () => {
                const passwordInput = icon.previousElementSibling;
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text'; icon.classList.replace('fa-eye', 'fa-eye-slash');
                } else {
                    passwordInput.type = 'password'; icon.classList.replace('fa-eye-slash', 'fa-eye');
                }
            });
        });

        document.getElementById('signin-btn').onclick = async () => {
            const emailInput = document.getElementById('signin-email');
            const pwInput = document.getElementById('signin-password');
            const email = emailInput.value.trim();
            const pw = pwInput.value.trim();
            let hasError = false;
            setError(emailInput, !email); if (!email) hasError = true;
            setError(pwInput, !pw); if (!pw) hasError = true;
            if (hasError) return;

            try {
                const response = await fetch('api/login.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password: pw })
                });
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Login failed');
                }

                // Store user data in localStorage for frontend compatibility
                localStorage.setItem('tn_current_v1', JSON.stringify(data.user));
                showToast(data.message, 'success');
                setTimeout(() => {
                    window.location.href = data.user.role === 'admin' ? 'admin.html' : 'home.html';
                }, 800);
            } catch (error) {
                setError(emailInput, true);
                setError(pwInput, true);
                emailInput.nextElementSibling.textContent = error.message;
                pwInput.nextElementSibling.textContent = error.message;
                showToast(error.message, 'error');
            }
        };
        document.querySelectorAll('input').forEach(inp => {
            inp.addEventListener('input', () => { inp.parentElement.classList.remove('error'); });
        });
        document.getElementById('create-btn').onclick = async () => {
            const first = document.getElementById('first-name');
            const last = document.getElementById('last-name');
            const email = document.getElementById('create-email');
            const pw = document.getElementById('create-password');
            const repw = document.getElementById('re-password');
            const contact = document.getElementById('contact');
            const address = document.getElementById('address');
            let hasError = false;
            const pwPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[^A-Za-z0-9]).{8,15}$/;
            setError(first, !first.value.trim()); if (!first.value.trim()) hasError = true;
            setError(last, !last.value.trim()); if (!last.value.trim()) hasError = true;
            setError(contact, !contact.value.trim()); if (!contact.value.trim()) hasError = true;
            setError(email, !/^[\w.+-]+@gmail\.com$/.test(email.value.trim())); if (!/^[\w.+-]+@gmail\.com$/.test(email.value.trim())) hasError = true;
            setError(pw, !pwPattern.test(pw.value.trim())); if (!pwPattern.test(pw.value.trim())) hasError = true;
            setError(repw, pw.value.trim() !== repw.value.trim()); if (pw.value.trim() !== repw.value.trim()) hasError = true;
            if (hasError) return;

            const name = first.value.trim() + ' ' + last.value.trim();

            try {
                const response = await fetch('api/register.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name,
                        email: email.value.trim(),
                        password: pw.value.trim(),
                        contact: contact.value.trim(),
                        address: address.value.trim()
                    })
                });
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Registration failed');
                }

                // Store user data in localStorage for frontend compatibility
                localStorage.setItem('tn_current_v1', JSON.stringify(data.user));
                showToast(data.message, 'success');
                setTimeout(() => {
                    window.location.href = 'home.html';
                }, 800);
            } catch (error) {
                if (error.message.includes('Email already registered')) {
                    setError(email, true);
                    email.nextElementSibling.textContent = error.message;
                } else {
                    showToast(error.message, 'error');
                }
            }
        };
    </script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>AOS.init();</script>
</body>
</html>